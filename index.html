<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://richinfo.co/richpartners/in-page/js/richads-ob.js?pubid=988960&siteid=374654" async></script>
  <script type="module" src="https://richinfo.co/richpartners/push/js/rp-cl-ob.js?pubid=988960&siteid=374655&niche=33" async data-cfasync="false"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      margin: 0;
      padding: 0;
      background: #0a0a0a; /* Dark background */
      font-family: 'Poppins', sans-serif;
      color: #e0e0e0;
      overflow-x: hidden;
      line-height: 1.5;
    }
    h1 {
      font-size: 36px;
      text-align: center;
      color: #fff;
      margin: 20px 0;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: linear-gradient(90deg, #ff6f61, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }
    .main-content {
      padding: 20px;
      margin: 0 auto;
      max-width: 1200px;
      background: linear-gradient(135deg, #121212, #1c1c1c); /* Dark gradient */
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7); /* Dark shadow */
      border: 1px solid rgba(255, 215, 0, 0.1);
    }
    .section {
      background: rgba(20, 20, 20, 0.8); /* Dark section background */
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); /* Dark shadow */
      border: 1px solid rgba(255, 215, 0, 0.1);
      transition: transform 0.2s ease;
    }
    .section:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 15px rgba(255, 215, 0, 0.2);
    }
    .search-filter {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 15px;
    }
    .search-bar {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }
    input {
      padding: 10px 40px;
      border-radius: 8px;
      border: 1px solid #333; /* Dark border */
      background: #151515; /* Dark input background */
      color: #e0e0e0;
      font-size: 16px;
      width: 100%;
      transition: all 0.2s ease;
    }
    input:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }
    input::placeholder {
      color: #888; /* Darker placeholder */
    }
    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      fill: #ffd700;
    }
    input:focus + .search-icon {
      fill: #ffca28;
    }
    .clear-search {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: #d32f2f;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
    }
    input:not(:placeholder-shown) + .search-icon + .clear-search {
      display: flex;
    }
    .category-filter {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .category-filter button {
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid #ffd700;
      border-radius: 5px;
      padding: 8px 15px;
      color: #ffd700;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .category-filter button:hover {
      background: #ffd700;
      color: #1a1a1a;
    }
    .category-filter button.active {
      background: #ffd700;
      color: #1a1a1a;
    }
    .content-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* Fixed 3 columns per line */
      gap: 15px; /* Adjusted gap */
      padding: 15px;
      justify-content: center;
    }
    .card {
      background: rgba(25, 25, 25, 0.8); /* Dark card background */
      border-radius: 8px;
      text-align: center;
      transition: transform 0.2s ease;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6); /* Dark shadow */
      min-width: 0; /* Allow flexibility */
      position: relative; /* For positioning quality badge */
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    .card img {
      width: 100%;
      height: 200px; /* Kept at 200px */
      object-fit: cover;
      border-radius: 6px 6px 0 0;
      border: 1px solid #2a2a2a; /* Darker border */
      transition: transform 0.3s ease;
    }
    .card:hover img {
      transform: scale(1.05);
    }
    .card-title {
      color: #ffd700;
      padding: 8px; /* Reduced padding */
      font-size: 14px; /* Reduced font size */
      font-weight: 600;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .popularity-score {
      color: #ffca28; /* Gold-like color for stars */
      font-size: 12px;
      margin-top: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
    }
    .popularity-score .star {
      color: #ffca28;
    }
    .quality-badge {
      position: absolute;
      top: 0px; /* Upper corner */
      right: 0px; /* Right side */
      background: linear-gradient(45deg, #ff6f61, #d81b60);
      color: #fff;
      padding: 2px 6px; /* Reduced padding */
      border-radius: 3px; /* Smaller radius */
      font-size: 10px; /* Reduced font size */
      font-weight: 600;
      text-transform: uppercase;
    }
    .card:hover .quality-badge {
      transform: scale(1.1);
    }
    .loader {
      border: 2px solid #2a2a2a; /* Darker loader border */
      border-top: 4px solid #ffd700;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 15px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .skeleton {
      background: linear-gradient(90deg, #121212 25%, #1c1c1c 50%, #121212 75%); /* Dark skeleton gradient */
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite;
      border-radius: 8px;
      height: 200px; /* Matches grid view image height */
      min-width: 0; /* Allow flexibility */
    }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .details-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95); /* Dark modal background */
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .details-modal-content {
      background: #1a1a1a; /* Dark modal content */
      border-radius: 10px;
      padding: 20px;
      max-width: 90%;
      width: 400px;
      max-height: 80vh; /* Set maximum height to enable scrolling */
      overflow-y: auto; /* Enable vertical scrolling */
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7); /* Dark shadow */
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #d32f2f;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    .back-button {
      position: absolute;
      top: 10px;
      left: 15px;
      background: #ff4500;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    .title {
      color: #ffd700;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 15px;
    }
    .premium-badge {
      position: absolute;
      top: 10px;
      left: 15px;
      background: #ff9800;
      color: #fff;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }
    .details {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    .poster {
      flex: 0 0 120px;
    }
    .poster img {
      width: 100%;
      height: 150px; /* Reduced height */
      object-fit: cover;
      border-radius: 6px;
    }
    .info {
      flex: 1;
    }
    .info .type {
      color: #fff;
      font-size: 14px;
      margin-bottom: 5px;
    }
    .info .type span {
      color: #ffd700;
    }
    .info .description {
      background: rgba(0, 255, 0, 0.1);
      border-radius: 5px;
      padding: 10px;
      color: #00ff00;
      font-size: 12px;
    }
    .info .last-updated {
      color: #4fc3f7;
      font-size: 10px;
      margin-top: 5px;
    }
    .popularity {
      background: #ffca28;
      border-radius: 5px;
      padding: 8px 15px;
      color: #121212;
      font-size: 14px;
      text-align: center;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .popularity .star {
      color: #ffd700;
    }
    .server-block {
      margin-top: 10px;
    }
    .server {
      background: #252525;
      border-radius: 5px;
      padding: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }
    .server span {
      color: #fff;
      font-size: 14px;
      flex: 1;
    }
    .stream-btn, .download-btn {
      background: linear-gradient(45deg, #4a90e2, #50e3c2);
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      text-decoration: none; /* Remove underline */
    }
    .stream-btn:hover {
      background: #357abd;
    }
    .download-btn {
      background: linear-gradient(45deg, #e84949, #ff6f61);
    }
    .download-btn:hover {
      background: #c0392b;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95); /* Dark modal background */
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #1a1a1a; /* Dark modal content */
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      max-width: 90%;
      width: 400px;
    }
    .modal-content iframe {
      width: 100%;
      height: 200px;
      border: none;
    }
    .timer {
      color: #ce93d8;
      font-size: 10px;
      margin: 5px 0;
    }
    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    .nav-btn {
      background: #0288d1;
      color: #fff;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    .nav-btn:hover {
      background: #01579b;
    }
    .nav-btn:disabled {
      background: #444; /* Darker disabled button */
      cursor: not-allowed;
    }
    .page-indicator {
      color: #ff7043;
      font-size: 12px;
      padding: 5px;
    }
    @media (max-width: 768px) {
      h1 { font-size: 24px; margin: 15px 0; }
      .main-content { padding: 10px; }
      .section { padding: 10px; margin-bottom: 10px; }
      input { padding: 6px 25px; font-size: 12px; }
      .search-icon { width: 15px; height: 15px; }
      .clear-search { width: 20px; height: 20px; font-size: 12px; }
      .category-filter button { padding: 5px 10px; font-size: 10px; }
      .content-grid {
        grid-template-columns: repeat(3, 1fr); /* 3 columns on mobile */
        gap: 10px;
        padding: 10px;
      }
      .card { min-width: 0; }
      .card img { height: 150px; } /* Kept at 150px for mobile */
      .card-title { font-size: 10px; padding: 5px; }
      .popularity-score { font-size: 10px; gap: 1px; }
      .quality-badge { font-size: 6px; padding: 2px 2px; }
      .details-modal-content { width: 90%; padding: 10px; max-height: 80vh; overflow-y: auto; }
      .details { flex-direction: column; align-items: center; gap: 5px; }
      .poster { max-width: 80px; }
      .poster img { height: 120px; } /* Reduced height */
      .info .type { font-size: 12px; }
      .info .description { font-size: 10px; padding: 5px; }
      .info .last-updated { font-size: 10px; }
      .server { padding: 5px; gap: 5px; }
      .server span { font-size: 12px; }
      .stream-btn, .download-btn { font-size: 10px; padding: 5px 10px; gap: 4px; text-decoration: none; /* Remove underline on mobile */ }
      .popularity { font-size: 12px; padding: 6px 10px; gap: 3px; }
      .nav-btn { padding: 6px 10px; font-size: 10px; }
      .page-indicator { font-size: 10px; }
    }
  </style>
</head>
<body>
  <div class="main-content">
    
    <div class="section">
      <div class="search-filter">
        <div class="search-bar">
          <input type="text" id="searchTitle" placeholder="Search Movies/Series..." oninput="liveSearch()" aria-label="Search movies or series" />
          <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
          </svg>
          <button class="clear-search" onclick="clearSearch()" aria-label="Clear search">✕</button>
        </div>
        <div class="category-filter">
          <button onclick="filterByCategory('All')" class="active">All</button>
          <button onclick="filterByCategory('Bollywood')">Bollywood</button>
          <button onclick="filterByCategory('Hollywood')">Hollywood</button>
          <button onclick="filterByCategory('South')">Regional</button>
          <button onclick="filterByCategory('Web Series')">Web Series</button>
          <button onclick="filterByCategory('Adult Content')">Adult Content</button>
          <button onclick="filterByCategory('Anime')">Anime</button>
          <button onclick="filterByCategory('TV Serials')">TV Serials</button>
        </div>
      </div>
      <div id="searchResults" class="content-grid">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
      </div>
      <div class="nav-buttons">
        <button class="nav-btn" onclick="navigatePage(-1)" id="prevBtn" disabled>Previous</button>
        <span class="page-indicator" id="pageIndicator">Page 1</span>
        <button class="nav-btn" onclick="navigatePage(1)" id="nextBtn">Next</button>
      </div>
    </div>
    <div id="detailsModal" class="details-modal">
      <button class="close-btn" onclick="resetToHomepage()" aria-label="Close">×</button>
      <div class="details-modal-content">
        <div class="details-content">
          <!-- Content will be dynamically inserted -->
        </div>
      </div>
    </div>
    <div id="videoModal" class="modal">
      <div class="modal-content">
        <iframe id="ytPlayer" src="https://www.youtube.com/embed/dJLEqkzHwvM?enablejsapi=1" allow="autoplay; encrypted-media"></iframe>
        <div class="timer" id="timer">Please watch the video for 120 seconds</div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQ07MRzktdouO1097oa3OhLnvKRp9ZCgc",
      authDomain: "movies-5b99f.firebaseapp.com",
      projectId: "movies-5b99f",
      storageBucket: "movies-5b99f.firebasestorage.app",
      messagingSenderId: "479711405145",
      appId: "1:479711405145:web:636c6e74d126c3c8163d48",
      measurementId: "G-2M9S4MC9LM"
    };

    try {
      firebase.initializeApp(firebaseConfig);
      console.log("Firebase initialized successfully at 06:55 PM IST, Saturday, October 04, 2025");
    } catch (error) {
      console.error("Firebase initialization failed at 06:55 PM IST, Saturday, October 04, 2025:", error);
      alert("❌ Failed to connect to Firebase. Check configuration or network.");
      document.getElementById("searchResults").innerHTML = '<p class="no-content">Failed to connect to Firebase</p>';
    }

    const db = firebase.firestore();
    let allContent = [];
    let contentMap = new Map();
    let isDetailsView = false;
    let currentCategory = 'All';
    let player;
    let timerInterval;
    let secondsWatched = 0;
    let selectedContentId = null;
    let currentPage = 0;
    const postsPerPage = 15; // 15 posters per page
    const REQUIRED_SECONDS = 0;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('ytPlayer', {
        events: {
          'onReady': onPlayerReady
        }
      });
      console.log('YouTube API ready – player created at 06:55 PM IST, Saturday, October 04, 2025');
    }

    function onPlayerReady(event) {
      console.log('Player ready – attaching onStateChange listener at 06:55 PM IST, Saturday, October 04, 2025');
      player.addEventListener('onStateChange', onPlayerStateChange);
    }

    function onPlayerStateChange(event) {
      console.log('State change event fired at 06:55 PM IST, Saturday, October 04, 2025:', event.data);
      if (event.data === YT.PlayerState.PLAYING) {
        console.log('Video playing – starting timer at 06:55 PM IST, Saturday, October 04, 2025');
        startTimer();
      } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
        console.log('Video paused/ended – stopping timer at 06:55 PM IST, Saturday, October 04, 2025');
        stopTimer();
      }
    }

    function startTimer() {
      if (!timerInterval) {
        secondsWatched = 0;
        timerInterval = setInterval(() => {
          secondsWatched++;
          const remaining = REQUIRED_SECONDS - secondsWatched;
          document.getElementById('timer').textContent = `Please watch the video for ${remaining} seconds`;
          console.log(`Timer tick at 06:55 PM IST, Saturday, October 04, 2025: ${secondsWatched}/${REQUIRED_SECONDS} seconds`);
          if (secondsWatched >= REQUIRED_SECONDS) {
            clearInterval(timerInterval);
            timerInterval = null;
            document.getElementById('timer').textContent = 'Proceeding to content...';
            console.log('Timer complete – proceeding to details at 06:55 PM IST, Saturday, October 04, 2025');
            setTimeout(proceedToDetails, 500);
          }
        }, 1000);
      }
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
        console.log('Timer stopped at 06:55 PM IST, Saturday, October 04, 2025');
      }
    }

    function showVideoModal(id) {
      incrementPopularity(id);
      selectedContentId = id;
      secondsWatched = 0;
      document.getElementById('timer').textContent = `Please watch the video for ${REQUIRED_SECONDS} seconds`;
      document.getElementById('videoModal').style.display = 'flex';
      if (player && player.playVideo) {
        player.playVideo();
        console.log('Video play triggered at 06:55 PM IST, Saturday, October 04, 2025');
      } else {
        console.error('Player not ready – cannot play video at 06:55 PM IST, Saturday, October 04, 2025');
      }
    }

    function incrementPopularity(id) {
      const contentRef = db.collection("content").doc(id);
      contentRef.get().then(doc => {
        if (doc.exists) {
          const currentPopularity = doc.data().popularity || 0;
          const newPopularity = Math.min(currentPopularity + 1, 5); // Cap at 5 stars
          contentRef.update({ popularity: newPopularity })
            .then(() => {
              console.log(`Popularity incremented to ${newPopularity} for ID ${id} at 06:55 PM IST, Saturday, October 04, 2025`);
              // Update local content map
              const content = contentMap.get(id);
              if (content) {
                content.popularity = newPopularity;
                contentMap.set(id, content);
                liveSearch(); // Refresh the grid to show updated popularity
              }
            })
            .catch(error => {
              console.error("Error updating popularity at 06:55 PM IST, Saturday, October 04, 2025:", error);
            });
        }
      }).catch(error => {
        console.error("Error fetching document for popularity update at 06:55 PM IST, Saturday, October 04, 2025:", error);
      });
    }

    function proceedToDetails() {
      document.getElementById('videoModal').style.display = 'none';
      if (player && player.stopVideo) {
        player.stopVideo();
      }
      stopTimer();
      showDetailsById(selectedContentId);
    }

    function isValidUrl(url) {
      try {
        new URL(url);
        return true;
      } catch (e) {
        console.warn("Invalid URL detected at 06:55 PM IST, Saturday, October 04, 2025:", url);
        return false;
      }
    }

    function loadAllContent() {
      document.getElementById("searchResults").innerHTML = `
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
      `;
      db.collection("content").get()
        .then(snapshot => {
          allContent = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))
            .sort((a, b) => {
              const dateA = a.updatedAt ? new Date(a.updatedAt) : new Date();
              const dateB = b.updatedAt ? new Date(b.updatedAt) : new Date();
              return dateB - dateA;
            });
          allContent.forEach(item => contentMap.set(item.id, item));
          console.log("All content loaded (sorted by latest) at 06:55 PM IST, Saturday, October 04, 2025:", allContent);
          if (allContent.length === 0) {
            document.getElementById("searchResults").innerHTML = '<p class="no-content">No content available</p>';
            document.getElementById("prevBtn").disabled = true;
            document.getElementById("nextBtn").disabled = true;
            document.getElementById("pageIndicator").textContent = 'Page 1';
          }
          liveSearch();
        })
        .catch(error => {
          console.error("Error loading content at 06:55 PM IST, Saturday, October 04, 2025:", error);
          document.getElementById("searchResults").innerHTML = '<p class="no-content">Error fetching content: ' + error.message + '</p>';
          document.getElementById("prevBtn").disabled = true;
          document.getElementById("nextBtn").disabled = true;
          document.getElementById("pageIndicator").textContent = 'Page 1';
          alert("❌ Error fetching data: " + error.message);
          if (error.code === 'permission-denied') {
            alert("⚠️ Check Firestore rules: Set to 'allow read: if true;' for testing.");
          }
        });
    }

    function resetToHomepage() {
      isDetailsView = false;
      document.getElementById("detailsModal").style.display = 'none';
      document.getElementById("searchTitle").value = '';
      currentCategory = 'All';
      currentPage = 0;
      updateCategoryButtons();
      liveSearch();
      history.replaceState({ view: 'home' }, '', '');
      window.scrollTo({ top: 0, behavior: 'smooth' });
      console.log("Reset to homepage at 06:55 PM IST, Saturday, October 04, 2025");
    }

    function liveSearch() {
      const keyword = document.getElementById("searchTitle").value.toLowerCase().trim();
      const searchResults = document.getElementById("searchResults");
      const clearButton = document.querySelector('.clear-search');
      clearButton.style.display = keyword ? 'flex' : 'none';
      let filteredContent = allContent.filter(item => 
        item.title && item.title.toLowerCase().includes(keyword)
      );
      if (currentCategory !== 'All') {
        filteredContent = filteredContent.filter(item => item.category === currentCategory);
      }
      const totalPages = Math.ceil(filteredContent.length / postsPerPage);
      document.getElementById("prevBtn").disabled = currentPage <= 0;
      document.getElementById("nextBtn").disabled = currentPage >= totalPages - 1;
      document.getElementById("pageIndicator").textContent = `Page ${currentPage + 1}${totalPages > 0 ? ` of ${totalPages}` : ''}`;
      const startIndex = currentPage * postsPerPage;
      const paginatedContent = filteredContent.slice(startIndex, startIndex + postsPerPage);
      if (paginatedContent.length === 0) {
        searchResults.innerHTML = '<p class="no-content">No content found</p>';
        document.getElementById("prevBtn").disabled = true;
        document.getElementById("nextBtn").disabled = true;
        document.getElementById("pageIndicator").textContent = 'Page 1';
      } else {
        searchResults.innerHTML = paginatedContent.map(item => `
          <div class="card" onclick="showVideoModal('${item.id}')" aria-label="${item.title}">
            <div class="quality-badge">${item.quality || 'HD'}</div>
            <img src="${item.poster || 'https://via.placeholder.com/200x300'}" alt="${item.title} poster" loading="lazy" />
            <div class="card-title">${item.title}</div>
            <div class="popularity-score">
              ${'★'.repeat(item.popularity || 0)}${'☆'.repeat(5 - (item.popularity || 0))}
            </div>
          </div>`).join('');
      }
    }

    function navigatePage(direction) {
      currentPage += direction;
      liveSearch();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function clearSearch() {
      document.getElementById("searchTitle").value = '';
      currentPage = 0;
      liveSearch();
    }

    function filterByCategory(category) {
      currentCategory = category;
      currentPage = 0;
      updateCategoryButtons();
      liveSearch();
      console.log(`Filtered by category: ${category} at 06:55 PM IST, Saturday, October 04, 2025`);
    }

    function updateCategoryButtons() {
      const buttons = document.querySelectorAll('.category-filter button');
      buttons.forEach(button => {
        button.classList.toggle('active', button.textContent === currentCategory);
      });
    }

    function showDetailsById(id) {
      const data = contentMap.get(id);
      if (!data || !data.id || !data.title) {
        console.error("Invalid or missing post data for ID at 06:55 PM IST, Saturday, October 04, 2025:", id);
        document.getElementById("detailsModal").innerHTML = '<p class="no-content">Error: Invalid or missing post data</p>';
        return;
      }

      const detailsContainer = document.getElementById("detailsModal").querySelector('.details-content');
      const currentDateTime = new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata", hour12: true });
      const isPremium = data.premium || false;

      try {
        const sortedEpisodes = data.type === "series" && data.episodes && Array.isArray(data.episodes) 
          ? [...data.episodes].sort((a, b) => {
              const dateA = a.updatedAt ? new Date(a.updatedAt) : new Date(0);
              const dateB = b.updatedAt ? new Date(b.updatedAt) : new Date(0);
              if (dateB.getTime() === dateA.getTime()) {
                return (b.episodeNumber || '').localeCompare(a.episodeNumber || '', undefined, { numeric: true });
              }
              return dateB - dateA;
            })
          : [];

        console.log(`Rendering details for ${data.title} with sorted episodes at 06:55 PM IST, Saturday, October 04, 2025:`, sortedEpisodes);

        detailsContainer.innerHTML = `
          <button class="back-button" onclick="resetToHomepage()">Back to Home</button>
          <div class="title">${data.title}</div>
          ${isPremium ? '<div class="premium-badge">Premium</div>' : ''}
          <div class="popularity">
            Popularity: ${'★'.repeat(data.popularity || 0)}${'☆'.repeat(5 - (data.popularity || 0))}
          </div>
          <div class="details">
            <div class="poster">
              <img src="${data.poster || 'https://via.placeholder.com/120x180'}" alt="${data.title} Poster" />
            </div>
            <div class="info">
              <div class="type">Type: <span>${data.type === "movie" ? "movie" : "series"}</span></div>
              <div class="description">${data.description || "No description available"}</div>
              <div class="last-updated">Last Updated: ${data.updatedAt ? new Date(data.updatedAt).toLocaleString("en-US", { timeZone: "Asia/Kolkata", hour12: true }) : currentDateTime}</div>
            </div>
          </div>
          <div class="server-block">
            ${data.type === "movie" && data.servers && Array.isArray(data.servers) && data.servers.length ? `
              ${data.servers.map((s, index) => `
                <div class="server" aria-label="Server ${index + 1} for ${data.title}">
                  <span>Server ${index + 1} (${s.quality || 'HD'})</span>
                  ${s.streaming && isValidUrl(s.streaming) ? `
                    <a href="${s.streaming}" target="_blank" rel="noopener noreferrer" class="stream-btn" aria-label="Stream ${data.title} Server ${index + 1}"><i class="fas fa-play"></i> Stream</a>
                  ` : `<button class="stream-btn" disabled aria-label="Streaming unavailable"><i class="fas fa-play"></i> Stream</button>`}
                  ${s.download && isValidUrl(s.download) ? `
                    <a href="${s.download}" target="_blank" rel="noopener noreferrer" class="download-btn" download aria-label="Download ${data.title} Server ${index + 1}"><i class="fas fa-download"></i> Download</a>
                  ` : `<button class="download-btn" disabled aria-label="Download unavailable"><i class="fas fa-download"></i> Download</button>`}
                </div>
              `).join('')}
            ` : data.type === "movie" ? `<p class="no-content">No servers available</p>` : ""}
            ${data.type === "series" && sortedEpisodes.length ? `
              ${sortedEpisodes.map((e, index) => `
                <div class="server" aria-label="Episode ${e.episodeNumber || index + 1} for ${data.title}">
                  <span>Episode ${e.episodeNumber || index + 1}${e.title ? ` - ${e.title}` : ''}</span>
                  ${e.streaming && isValidUrl(e.streaming) ? `
                    <a href="${e.streaming}" target="_blank" rel="noopener noreferrer" class="stream-btn" aria-label="Stream ${data.title} Episode ${e.episodeNumber || index + 1}"><i class="fas fa-play"></i> Stream</a>
                  ` : `<button class="stream-btn" disabled aria-label="Streaming unavailable"><i class="fas fa-play"></i> Stream</button>`}
                  ${e.download && isValidUrl(e.download) ? `
                    <a href="${e.download}" target="_blank" rel="noopener noreferrer" class="download-btn" download aria-label="Download ${data.title} Episode ${e.episodeNumber || index + 1}"><i class="fas fa-download"></i> Download</a>
                  ` : `<button class="download-btn" disabled aria-label="Download unavailable"><i class="fas fa-download"></i> Download</button>`}
                </div>
              `).join('')}
            ` : data.type === "series" ? `<p class="no-content">No episodes available</p>` : ""}
          </div>
        `;
        document.getElementById("detailsModal").style.display = "flex";
        isDetailsView = true;
        history.pushState({ view: 'details', id: data.id }, '', `#details-${data.id}`);
        console.log("Showing details modal for:", data.id, data.title);
      } catch (error) {
        console.error("Error rendering details at 06:55 PM IST, Saturday, October 04, 2025:", error);
        detailsContainer.innerHTML = '<p class="no-content">Error rendering content details. Please try again.</p>';
        document.getElementById("detailsModal").style.display = "flex";
      }
    }

    window.addEventListener('popstate', (event) => {
      console.log("Back button pressed at 06:55 PM IST, Saturday, October 04, 2025", event.state);
      if (isDetailsView || (event.state && event.state.view !== 'home')) {
        resetToHomepage();
      }
    });

    window.onload = () => {
      console.log("Loading all content at 06:55 PM IST, Saturday, October 04, 2025...");
      history.replaceState({ view: 'home' }, '', '');
      loadAllContent();
    };
  </script>
</body>
</html>
